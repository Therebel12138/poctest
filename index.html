<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivo Video JS Bridge 测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #007cba;
            padding-bottom: 5px;
        }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #005a8b;
        }
        
        input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        .result {
            background: #e8f4f8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007cba;
            font-family: monospace;
            word-break: break-all;
        }
        
        .error {
            background: #ffe6e6;
            border-left-color: #ff4444;
        }
        
        .success {
            background: #e6ffe6;
            border-left-color: #44ff44;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vivo Video JS Bridge 测试页面</h1>
        
        <!-- 设备信息获取 -->
        <div class="section">
            <h2>设备信息获取</h2>
            <button onclick="getDeviceInfo()">获取设备信息</button>
            <button onclick="getNetworkInfo()">获取网络信息</button>
            <button onclick="getAppInfo()">获取应用信息</button>
            <div id="deviceInfo" class="result" style="display:none;"></div>
        </div>

        <!-- 用户信息 -->
        <div class="section">
            <h2>用户信息</h2>
            <button onclick="checkLogin()">检查登录状态</button>
            <button onclick="getUserToken()">获取用户Token</button>
            <button onclick="goLogin()">跳转登录</button>
            <div id="userInfo" class="result" style="display:none;"></div>
        </div>

        <!-- 页面导航 -->
        <div class="section">
            <h2>页面导航</h2>
            <input type="text" id="h5Url" placeholder="输入H5页面URL" value="https://www.example.com">
            <button onclick="jumpToH5()">跳转H5页面</button>
            <br>
            <input type="text" id="appUrl" placeholder="输入App URL" value="vivovideo://home">
            <button onclick="jumpToApp()">跳转App页面</button>
            <br>
            <button onclick="closeWebView()">关闭WebView</button>
            <button onclick="handleBack()">返回操作</button>
        </div>

        <!-- 支付相关 -->
        <div class="section">
            <h2>支付功能</h2>
            <input type="text" id="payData" placeholder="支付数据" value='{"productId":"test123","amount":"10.00"}'>
            <input type="text" id="payCallback" placeholder="支付回调" value="payCallback">
            <br>
            <button onclick="testPay()">普通支付</button>
            <button onclick="testPaySingular()">单次支付</button>
            <button onclick="testPayAutoRenew()">自动续费支付</button>
            <div id="payResult" class="result" style="display:none;"></div>
        </div>

        <!-- 积分相关 -->
        <div class="section">
            <h2>积分功能</h2>
            <button onclick="getPointInfo()">获取积分信息</button>
            <button onclick="signInPoint()">签到积分</button>
            <input type="number" id="balanceChange" placeholder="积分变化" value="100">
            <button onclick="changeBalance()">积分变化</button>
            <div id="pointResult" class="result" style="display:none;"></div>
        </div>

        <!-- 应用检测 -->
        <div class="section">
            <h2>应用检测</h2>
            <input type="text" id="packageName" placeholder="包名" value="com.android.browser">
            <button onclick="checkAppInstalled()">检查应用是否安装</button>
            <input type="text" id="appVersionPackage" placeholder="包名" value="com.vivo.videoplayer">
            <button onclick="getAppVersionCode()">获取应用版本号</button>
            <div id="appCheckResult" class="result" style="display:none;"></div>
        </div>

        <!-- 系统功能 -->
        <div class="section">
            <h2>系统功能</h2>
            <button onclick="showToast()">显示Toast</button>
            <button onclick="checkMode()">检查模式</button>
            <button onclick="getUiMode()">获取UI模式</button>
            <button onclick="turnToFaq()">跳转FAQ</button>
            <div id="systemResult" class="result" style="display:none;"></div>
        </div>

        <!-- 网络请求 -->
        <div class="section">
            <h2>网络请求</h2>
            <input type="text" id="httpUrl" placeholder="请求URL" value="https://httpbin.org/get">
            <button onclick="requestHttp()">发起HTTP请求</button>
            <div id="httpResult" class="result" style="display:none;"></div>
        </div>

        <!-- 事件追踪 -->
        <div class="section">
            <h2>事件追踪</h2>
            <input type="text" id="eventId" placeholder="事件ID" value="test_event">
            <input type="text" id="eventData" placeholder="事件数据" value='{"action":"click","page":"test"}'>
            <button onclick="traceEvent()">发送事件追踪</button>
            <div id="traceResult" class="result" style="display:none;"></div>
        </div>

        <!-- 返回监听 -->
        <div class="section">
            <h2>返回按键监听</h2>
            <button onclick="registerBackListener()">注册返回监听</button>
            <button onclick="unregisterBackListener()">取消返回监听</button>
            <div id="backResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        // 检查 AccountInfo 对象是否可用
        function checkBridge() {
            if (typeof AccountInfo === 'undefined') {
                console.warn('AccountInfo bridge not available');
                return false;
            }
            return true;
        }

        // 显示结果
        function showResult(elementId, result, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'result error' : 'result success';
            element.innerHTML = typeof result === 'object' ? JSON.stringify(result, null, 2) : result;
        }

        // 设备信息获取
        function getDeviceInfo() {
            if (!checkBridge()) return;
            
            try {
                const deviceInfo = {
                    model: AccountInfo.getModel(),
                    androidVersion: AccountInfo.getAv(),
                    vOsVersion: AccountInfo.getVOs(),
                    vAppVersion: AccountInfo.getVApp(),
                    oaid: AccountInfo.getOaid(),
                    aaid: AccountInfo.getAaid(),
                    vaid: AccountInfo.getVaid(),
                    uuid: AccountInfo.getU(),
                    cpuInfo: AccountInfo.getCpuInfo(),
                    localIp: AccountInfo.getLocalIpAddress(),
                    userAgent: AccountInfo.getUa()
                };
                showResult('deviceInfo', deviceInfo);
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        function getNetworkInfo() {
            if (!checkBridge()) return;
            
            try {
                const networkInfo = {
                    netType: AccountInfo.getNetType()
                };
                showResult('deviceInfo', networkInfo);
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        function getAppInfo() {
            if (!checkBridge()) return;
            
            try {
                const appInfo = {
                    appName: AccountInfo.getAppName(),
                    channel: AccountInfo.getChannel(),
                    featureList: AccountInfo.getFeatureList(),
                    privacyVersion: AccountInfo.getPrivacyVersion()
                };
                showResult('deviceInfo', appInfo);
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        // 用户信息
        function checkLogin() {
            if (!checkBridge()) return;
            
            try {
                const isLogin = AccountInfo.checkLoginStatus();
                showResult('userInfo', 'Login Status: ' + isLogin);
            } catch (e) {
                showResult('userInfo', 'Error: ' + e.message, true);
            }
        }

        function getUserToken() {
            if (!checkBridge()) return;
            
            try {
                const token = AccountInfo.getToken();
                showResult('userInfo', 'Token: ' + token);
            } catch (e) {
                showResult('userInfo', 'Error: ' + e.message, true);
            }
        }

        function goLogin() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.gotoLogin('test_from_h5');
                showResult('userInfo', 'Login redirect initiated');
            } catch (e) {
                showResult('userInfo', 'Error: ' + e.message, true);
            }
        }

        // 页面导航
        function jumpToH5() {
            if (!checkBridge()) return;
            
            const url = document.getElementById('h5Url').value;
            try {
                AccountInfo.jumpH5(url);
                showResult('deviceInfo', 'H5 jump initiated to: ' + url);
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        function jumpToApp() {
            if (!checkBridge()) return;
            
            const url = document.getElementById('appUrl').value;
            try {
                AccountInfo.jumpToApp(url);
                showResult('deviceInfo', 'App jump initiated to: ' + url);
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        function closeWebView() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.onCloseWebViewFragment();
                showResult('deviceInfo', 'Close WebView initiated');
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        function handleBack() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.onBackPressed();
                showResult('deviceInfo', 'Back pressed');
            } catch (e) {
                showResult('deviceInfo', 'Error: ' + e.message, true);
            }
        }

        // 支付功能
        function testPay() {
            if (!checkBridge()) return;
            
            const payData = document.getElementById('payData').value;
            const callback = document.getElementById('payCallback').value;
            
            try {
                AccountInfo.onPay(payData, callback);
                showResult('payResult', 'Payment initiated');
            } catch (e) {
                showResult('payResult', 'Error: ' + e.message, true);
            }
        }

        function testPaySingular() {
            if (!checkBridge()) return;
            
            const payData = document.getElementById('payData').value;
            const callback = document.getElementById('payCallback').value;
            
            try {
                AccountInfo.onPaySingular(payData, callback);
                showResult('payResult', 'Singular payment initiated');
            } catch (e) {
                showResult('payResult', 'Error: ' + e.message, true);
            }
        }

        function testPayAutoRenew() {
            if (!checkBridge()) return;
            
            const payData = document.getElementById('payData').value;
            const callback = document.getElementById('payCallback').value;
            
            try {
                AccountInfo.onPayAutoRenew(payData, callback);
                showResult('payResult', 'Auto-renew payment initiated');
            } catch (e) {
                showResult('payResult', 'Error: ' + e.message, true);
            }
        }

        // 积分功能
        function getPointInfo() {
            if (!checkBridge()) return;
            
            try {
                const pointInfo = {
                    activityKey: AccountInfo.getPointActivityKey(),
                    playTime: AccountInfo.getPointPlayTime()
                };
                showResult('pointResult', pointInfo);
            } catch (e) {
                showResult('pointResult', 'Error: ' + e.message, true);
            }
        }

        function signInPoint() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.signInPoint(true);
                showResult('pointResult', 'Sign in point initiated');
            } catch (e) {
                showResult('pointResult', 'Error: ' + e.message, true);
            }
        }

        function changeBalance() {
            if (!checkBridge()) return;
            
            const balance = document.getElementById('balanceChange').value;
            try {
                AccountInfo.onBalanceChange(parseInt(balance));
                showResult('pointResult', 'Balance change: ' + balance);
            } catch (e) {
                showResult('pointResult', 'Error: ' + e.message, true);
            }
        }

        // 应用检测
        function checkAppInstalled() {
            if (!checkBridge()) return;
            
            const packageName = document.getElementById('packageName').value;
            try {
                const isInstalled = AccountInfo.isInstalledApp(packageName);
                showResult('appCheckResult', 'App ' + packageName + ' installed: ' + isInstalled);
            } catch (e) {
                showResult('appCheckResult', 'Error: ' + e.message, true);
            }
        }

        function getAppVersionCode() {
            if (!checkBridge()) return;
            
            const packageName = document.getElementById('appVersionPackage').value;
            try {
                const version = AccountInfo.getAppVersion(packageName);
                showResult('appCheckResult', 'App ' + packageName + ' version: ' + version);
            } catch (e) {
                showResult('appCheckResult', 'Error: ' + e.message, true);
            }
        }

        // 系统功能
        function showToast() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.showToast('Hello from H5!');
                showResult('systemResult', 'Toast shown');
            } catch (e) {
                showResult('systemResult', 'Error: ' + e.message, true);
            }
        }

        function checkMode() {
            if (!checkBridge()) return;
            
            try {
                const isMode = AccountInfo.isMode('test_mode');
                showResult('systemResult', 'Is test mode: ' + isMode);
            } catch (e) {
                showResult('systemResult', 'Error: ' + e.message, true);
            }
        }

        function getUiMode() {
            if (!checkBridge()) return;
            
            try {
                const uiMode = AccountInfo.getCurrentUiMode();
                showResult('systemResult', 'Current UI mode: ' + uiMode);
            } catch (e) {
                showResult('systemResult', 'Error: ' + e.message, true);
            }
        }

        function turnToFaq() {
            if (!checkBridge()) return;
            
            try {
                AccountInfo.turnToFaq();
                showResult('systemResult', 'FAQ page opened');
            } catch (e) {
                showResult('systemResult', 'Error: ' + e.message, true);
            }
        }

        // 网络请求
        function requestHttp() {
            if (!checkBridge()) return;
            
            const url = document.getElementById('httpUrl').value;
            try {
                AccountInfo.requestHttp(url);
                showResult('httpResult', 'HTTP request sent to: ' + url);
            } catch (e) {
                showResult('httpResult', 'Error: ' + e.message, true);
            }
        }

        // 事件追踪
        function traceEvent() {
            if (!checkBridge()) return;
            
            const eventId = document.getElementById('eventId').value;
            const eventData = document.getElementById('eventData').value;
            
            try {
                AccountInfo.onTraceDelayEvent(eventId, eventData);
                showResult('traceResult', 'Event traced: ' + eventId);
            } catch (e) {
                showResult('traceResult', 'Error: ' + e.message, true);
            }
        }

        // 返回按键监听
        function registerBackListener() {
            if (!checkBridge()) return;
            
            try {
                const backConfig = JSON.stringify({
                    backPressCallback: 'onBackPressed'
                });
                AccountInfo.registerBack(backConfig, '');
                showResult('backResult', 'Back listener registered');
                
                // 定义回调函数
                window.onBackPressed = function() {
                    showResult('backResult', 'Back button pressed! Custom handler called.');
                };
            } catch (e) {
                showResult('backResult', 'Error: ' + e.message, true);
            }
        }

        function unregisterBackListener() {
            if (!checkBridge()) return;
            
            try {
                const backConfig = JSON.stringify({
                    backPressCallback: 'onBackPressed'
                });
                AccountInfo.unregisterBack(backConfig, '');
                showResult('backResult', 'Back listener unregistered');
            } catch (e) {
                showResult('backResult', 'Error: ' + e.message, true);
            }
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, checking bridge availability...');
            if (checkBridge()) {
                console.log('AccountInfo bridge is available');
                showResult('deviceInfo', 'Bridge available - Ready to test!');
            } else {
                console.log('AccountInfo bridge is not available');
                showResult('deviceInfo', 'Bridge not available - Please load in Vivo Video App', true);
            }
        });

        // 支付回调示例
        function payCallback(result) {
            showResult('payResult', 'Payment callback received: ' + JSON.stringify(result));
        }
    </script>
</body>
</html>
