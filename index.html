<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie管理和页面控制</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 12px 24px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        #cookieDisplay {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            min-height: 50px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>页面Cookie管理</h1>
        
        <!-- 按钮组 -->
        <div class="button-group">
            <button class="btn btn-primary" onclick="showCookies()">
                📋 显示当前页面Cookie
            </button>
            
            <button class="btn btn-success" onclick="setCookies()">
                ➕ 设置示例Cookie
            </button>
            
            <button class="btn btn-danger" onclick="closePage()">
                ❌ 关闭页面
            </button>
        </div>
        
        <!-- Cookie显示区域 -->
        <div id="cookieDisplay" class="hidden"></div>
    </div>

    <script>
        // 显示当前页面的所有cookie
        function showCookies() {
            const cookieDisplay = document.getElementById('cookieDisplay');
            const cookies = document.cookie;
            
            if (cookies) {
                // 格式化cookie显示
                const cookieArray = cookies.split(';');
                let formattedCookies = '当前页面的Cookie信息：\n\n';
                
                cookieArray.forEach((cookie, index) => {
                    const [name, value] = cookie.trim().split('=');
                    formattedCookies += `${index + 1}. ${name} = ${value || '(空值)'}\n`;
                });
                
                cookieDisplay.textContent = formattedCookies;
            } else {
                cookieDisplay.textContent = '当前页面没有设置任何Cookie';
            }
            
            // 显示cookie区域
            cookieDisplay.classList.remove('hidden');
        }
        
        // 设置一些示例cookie（用于测试）
        function setCookies() {
            const now = new Date();
            const expires = new Date(now.getTime() + 24 * 60 * 60 * 1000); // 24小时后过期
            
            // 设置几个示例cookie
            document.cookie = `username=testuser; expires=${expires.toUTCString()}; path=/`;
            document.cookie = `theme=dark; expires=${expires.toUTCString()}; path=/`;
            document.cookie = `language=zh-CN; expires=${expires.toUTCString()}; path=/`;
            document.cookie = `visitTime=${now.toISOString()}; expires=${expires.toUTCString()}; path=/`;
            
            alert('已设置示例Cookie，点击"显示Cookie"查看效果');
        }
        
        // 关闭页面的函数
        function closePage() {
            // 显示确认对话框
            const confirmClose = confirm('确定要关闭这个页面吗？');
            
            if (confirmClose) {
                // 触发beforeunload事件（如果有设置的话）
                window.onbeforeunload = function() {
                    return '您确定要离开此页面吗？';
                };
                
                // 尝试关闭窗口
                try {
                    // 如果是通过脚本打开的窗口，可以直接关闭
                    window.close();
                } catch (e) {
                    // 如果无法直接关闭，给用户提示
                    alert('无法直接关闭页面，请手动关闭浏览器标签页');
                }
                
                // 备选方案：跳转到空白页或其他页面
                // window.location.href = 'about:blank';
            }
        }
        
        // 页面加载时的初始化
        window.onload = function() {
            console.log('页面已加载完成');
            
            // 可以在这里设置一些默认行为
            // 比如自动显示cookie信息
            // showCookies();
        };
        
        // 设置beforeunload事件处理（可选）
        window.onbeforeunload = function(e) {
            // 这会触发你之前看到的 onJsBeforeUnload 方法
            return '您确定要离开此页面吗？未保存的更改可能会丢失。';
        };
    </script>
</body>
</html>
