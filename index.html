<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        
        .section h3 {
            color: #555;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        .result {
            background-color: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSBridge æµ‹è¯•é¡µé¢</h1>
        
        <!-- è®¾å¤‡ä¿¡æ¯è·å– -->
        <div class="section">
            <h3>ğŸ“± è®¾å¤‡ä¿¡æ¯è·å–</h3>
            <button onclick="getDeviceInfo()">è·å–è®¾å¤‡ä¿¡æ¯</button>
            <button onclick="getAppInfo()">è·å–åº”ç”¨ä¿¡æ¯</button>
            <button onclick="getNetworkInfo()">è·å–ç½‘ç»œä¿¡æ¯</button>
            <div id="deviceInfo" class="result"></div>
        </div>

        <!-- ç”¨æˆ·ç›¸å…³ -->
        <div class="section">
            <h3>ğŸ‘¤ ç”¨æˆ·ç›¸å…³</h3>
            <button onclick="checkLogin()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
            <button onclick="gotoLogin()">è·³è½¬ç™»å½•</button>
            <div id="userInfo" class="result"></div>
        </div>

        <!-- é¡µé¢å¯¼èˆª -->
        <div class="section">
            <h3>ğŸ”— é¡µé¢å¯¼èˆª</h3>
            <div class="input-group">
                <label>H5 URL:</label>
                <input type="text" id="h5Url" placeholder="è¾“å…¥H5é¡µé¢URL" value="https://example.com">
                <button onclick="jumpToH5()">è·³è½¬H5é¡µé¢</button>
            </div>
            <div class="input-group">
                <label>APPåŒ…å:</label>
                <input type="text" id="appPackage" placeholder="è¾“å…¥APPåŒ…å" value="com.example.app">
                <button onclick="jumpToApp()">è·³è½¬APP</button>
                <button onclick="checkAppInstalled()">æ£€æŸ¥APPæ˜¯å¦å®‰è£…</button>
            </div>
            <div class="input-group">
                <label>è§†é¢‘URL:</label>
                <input type="text" id="videoUrl" placeholder="è¾“å…¥è§†é¢‘URL" value="http://example.com/video.mp4">
                <button onclick="playVideo()">æ’­æ”¾è§†é¢‘</button>
            </div>
            <div id="navigationResult" class="result"></div>
        </div>

        <!-- ç§¯åˆ†ç›¸å…³ -->
        <div class="section">
            <h3>ğŸ¯ ç§¯åˆ†ç›¸å…³</h3>
            <button onclick="getPointInfo()">è·å–ç§¯åˆ†ä¿¡æ¯</button>
            <button onclick="signInPoint()">ç­¾åˆ°ç§¯åˆ†</button>
            <div class="input-group">
                <label>ç§¯åˆ†å˜åŒ–:</label>
                <input type="number" id="balanceChange" placeholder="è¾“å…¥ç§¯åˆ†å˜åŒ–å€¼" value="100">
                <button onclick="changeBalance()">è§¦å‘ç§¯åˆ†å˜åŒ–</button>
            </div>
            <div id="pointResult" class="result"></div>
        </div>

        <!-- æ”¯ä»˜ç›¸å…³ -->
        <div class="section">
            <h3>ğŸ’° æ”¯ä»˜ç›¸å…³</h3>
            <div class="input-group">
                <label>å•†å“ID:</label>
                <input type="text" id="productId" placeholder="è¾“å…¥å•†å“ID" value="product_001">
            </div>
            <div class="input-group">
                <label>è®¢å•ä¿¡æ¯:</label>
                <input type="text" id="orderInfo" placeholder="è¾“å…¥è®¢å•ä¿¡æ¯" value='{"orderId":"12345","amount":"99.00"}'>
            </div>
            <button onclick="onPay()">æ™®é€šæ”¯ä»˜</button>
            <button onclick="onPaySingular()">å•æ¬¡æ”¯ä»˜</button>
            <button onclick="onPayAutoRenew()">è‡ªåŠ¨ç»­è´¹æ”¯ä»˜</button>
            <div id="payResult" class="result"></div>
        </div>

        <!-- ç³»ç»ŸåŠŸèƒ½ -->
        <div class="section">
            <h3>âš™ï¸ ç³»ç»ŸåŠŸèƒ½</h3>
            <button onclick="showToast()">æ˜¾ç¤ºToast</button>
            <button onclick="onBackPressed()">è§¦å‘è¿”å›</button>
            <button onclick="closeWebView()">å…³é—­WebView</button>
            <button onclick="getCurrentUiMode()">è·å–UIæ¨¡å¼</button>
            <button onclick="turnToFaq()">è·³è½¬FAQ</button>
            <div id="systemResult" class="result"></div>
        </div>

        <!-- äº‹ä»¶è¿½è¸ª -->
        <div class="section">
            <h3>ğŸ“Š äº‹ä»¶è¿½è¸ª</h3>
            <div class="input-group">
                <label>äº‹ä»¶ID:</label>
                <input type="text" id="eventId" placeholder="è¾“å…¥äº‹ä»¶ID" value="page_view">
            </div>
            <div class="input-group">
                <label>äº‹ä»¶ä¿¡æ¯:</label>
                <input type="text" id="eventInfo" placeholder="è¾“å…¥äº‹ä»¶ä¿¡æ¯JSON" value='{"page":"test","action":"click"}'>
            </div>
            <button onclick="traceEvent()">è¿½è¸ªäº‹ä»¶</button>
            <div id="eventResult" class="result"></div>
        </div>

        <!-- å…¶ä»–åŠŸèƒ½ -->
        <div class="section">
            <h3>ğŸ”§ å…¶ä»–åŠŸèƒ½</h3>
            <div class="input-group">
                <label>URLç­¾å:</label>
                <input type="text" id="signUrl" placeholder="è¾“å…¥éœ€è¦ç­¾åçš„URL" value="https://api.example.com/data">
                <button onclick="getSignParams()">è·å–ç­¾åå‚æ•°</button>
            </div>
            <div class="input-group">
                <label>HTTPè¯·æ±‚:</label>
                <input type="text" id="httpUrl" placeholder="è¾“å…¥HTTP URL" value="https://api.example.com/test">
                <button onclick="requestHttp()">å‘èµ·HTTPè¯·æ±‚</button>
            </div>
            <button onclick="handlePageSuccess()">é¡µé¢åŠ è½½æˆåŠŸ</button>
            <button onclick="createPreConnect()">åˆ›å»ºé¢„è¿æ¥</button>
            <div id="otherResult" class="result"></div>
        </div>

        <!-- è¿”å›é”®æ³¨å†Œæµ‹è¯• -->
        <div class="section">
            <h3>â¬…ï¸ è¿”å›é”®å¤„ç†</h3>
            <button onclick="registerBackPress()">æ³¨å†Œè¿”å›é”®ç›‘å¬</button>
            <button onclick="unregisterBackPress()">å–æ¶ˆè¿”å›é”®ç›‘å¬</button>
            <button onclick="testBackPress()">æµ‹è¯•è¿”å›é”®</button>
            <div id="backResult" class="result"></div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥H5Interfaceæ˜¯å¦å¯ç”¨
        function checkInterface() {
            if (typeof H5Interface === 'undefined') {
                alert('H5Interface ä¸å¯ç”¨ï¼Œè¯·åœ¨æ”¯æŒçš„WebViewç¯å¢ƒä¸­æ‰“å¼€');
                return false;
            }
            return true;
        }

        // è®¾å¤‡ä¿¡æ¯è·å–
        function getDeviceInfo() {
            if (!checkInterface()) return;
            
            try {
                const deviceInfo = {
                    model: H5Interface.getModel(),
                    aaid: H5Interface.getAaid(),
                    oaid: H5Interface.getOaid(),
                    vaid: H5Interface.getVaid(),
                    u: H5Interface.getU(),
                    ua: H5Interface.getUa(),
                    vApp: H5Interface.getVApp(),
                    vOs: H5Interface.getVOs(),
                    av: H5Interface.getAv(),
                    cpuInfo: H5Interface.getCpuInfo(),
                    localIp: H5Interface.getLocalIpAddress(),
                    token: H5Interface.getToken()
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(deviceInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = 'è·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥: ' + e.message;
            }
        }

        function getAppInfo() {
            if (!checkInterface()) return;
            
            try {
                const appInfo = {
                    appName: H5Interface.getAppName(),
                    channel: H5Interface.getChannel(),
                    featureList: H5Interface.getFeatureList(),
                    privacyVersion: H5Interface.getPrivacyVersion(),
                    appVersion: H5Interface.getAppVersion('com.vivo.video')
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(appInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = 'è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥: ' + e.message;
            }
        }

        function getNetworkInfo() {
            if (!checkInterface()) return;
            
            try {
                const networkInfo = {
                    netType: H5Interface.getNetType()
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(networkInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = 'è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥: ' + e.message;
            }
        }

        // ç”¨æˆ·ç›¸å…³
        function checkLogin() {
            if (!checkInterface()) return;
            
            try {
                const isLoggedIn = H5Interface.checkLoginStatus();
                document.getElementById('userInfo').textContent = 'ç™»å½•çŠ¶æ€: ' + (isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•');
            } catch (e) {
                document.getElementById('userInfo').textContent = 'æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥: ' + e.message;
            }
        }

        function gotoLogin() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.gotoLogin('test_callback');
                document.getElementById('userInfo').textContent = 'å·²è°ƒç”¨ç™»å½•æ¥å£';
            } catch (e) {
                document.getElementById('userInfo').textContent = 'è°ƒç”¨ç™»å½•å¤±è´¥: ' + e.message;
            }
        }

        // é¡µé¢å¯¼èˆª
        function jumpToH5() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('h5Url').value;
            try {
                H5Interface.jumpH5(url);
                document.getElementById('navigationResult').textContent = 'å·²è·³è½¬åˆ°: ' + url;
            } catch (e) {
                document.getElementById('navigationResult').textContent = 'è·³è½¬å¤±è´¥: ' + e.message;
            }
        }

        function jumpToApp() {
            if (!checkInterface()) return;
            
            const packageName = document.getElementById('appPackage').value;
            try {
                H5Interface.jumpToApp(packageName);
                document.getElementById('navigationResult').textContent = 'å·²å°è¯•æ‰“å¼€APP: ' + packageName;
            } catch (e) {
                document.getElementById('navigationResult').textContent = 'æ‰“å¼€APPå¤±è´¥: ' + e.message;
            }
        }

        function checkAppInstalled() {
            if (!checkInterface()) return;
            
            const packageName = document.getElementById('appPackage').value;
            try {
                const isInstalled = H5Interface.isInstalledApp(packageName);
                document.getElementById('navigationResult').textContent = 
                    packageName + (isInstalled ? ' å·²å®‰è£…' : ' æœªå®‰è£…');
            } catch (e) {
                document.getElementById('navigationResult').textContent = 'æ£€æŸ¥APPå®‰è£…çŠ¶æ€å¤±è´¥: ' + e.message;
            }
        }

        function playVideo() {
            if (!checkInterface()) return;
            
            const videoUrl = document.getElementById('videoUrl').value;
            try {
                H5Interface.playVideo(videoUrl);
                document.getElementById('navigationResult').textContent = 'å·²è°ƒç”¨æ’­æ”¾è§†é¢‘: ' + videoUrl;
            } catch (e) {
                document.getElementById('navigationResult').textContent = 'æ’­æ”¾è§†é¢‘å¤±è´¥: ' + e.message;
            }
        }

        // ç§¯åˆ†ç›¸å…³
        function getPointInfo() {
            if (!checkInterface()) return;
            
            try {
                const pointInfo = {
                    pointActivityKey: H5Interface.getPointActivityKey(),
                    pointPlayTime: H5Interface.getPointPlayTime()
                };
                
                document.getElementById('pointResult').textContent = JSON.stringify(pointInfo, null, 2);
            } catch (e) {
                document.getElementById('pointResult').textContent = 'è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥: ' + e.message;
            }
        }

        function signInPoint() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.signInPoint(true);
                document.getElementById('pointResult').textContent = 'å·²è°ƒç”¨ç­¾åˆ°ç§¯åˆ†æ¥å£';
            } catch (e) {
                document.getElementById('pointResult').textContent = 'ç­¾åˆ°å¤±è´¥: ' + e.message;
            }
        }

        function changeBalance() {
            if (!checkInterface()) return;
            
            const balance = document.getElementById('balanceChange').value;
            try {
                H5Interface.onBalanceChange(parseInt(balance));
                document.getElementById('pointResult').textContent = 'å·²è§¦å‘ç§¯åˆ†å˜åŒ–: ' + balance;
            } catch (e) {
                document.getElementById('pointResult').textContent = 'è§¦å‘ç§¯åˆ†å˜åŒ–å¤±è´¥: ' + e.message;
            }
        }

        // æ”¯ä»˜ç›¸å…³
        function onPay() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPay(productId, orderInfo);
                document.getElementById('payResult').textContent = 'å·²è°ƒç”¨æ™®é€šæ”¯ä»˜æ¥å£';
            } catch (e) {
                document.getElementById('payResult').textContent = 'æ”¯ä»˜è°ƒç”¨å¤±è´¥: ' + e.message;
            }
        }

        function onPaySingular() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPaySingular(productId, orderInfo);
                document.getElementById('payResult').textContent = 'å·²è°ƒç”¨å•æ¬¡æ”¯ä»˜æ¥å£';
            } catch (e) {
                document.getElementById('payResult').textContent = 'å•æ¬¡æ”¯ä»˜è°ƒç”¨å¤±è´¥: ' + e.message;
            }
        }

        function onPayAutoRenew() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPayAutoRenew(productId, orderInfo);
                document.getElementById('payResult').textContent = 'å·²è°ƒç”¨è‡ªåŠ¨ç»­è´¹æ”¯ä»˜æ¥å£';
            } catch (e) {
                document.getElementById('payResult').textContent = 'è‡ªåŠ¨ç»­è´¹æ”¯ä»˜è°ƒç”¨å¤±è´¥: ' + e.message;
            }
        }

        // ç³»ç»ŸåŠŸèƒ½
        function showToast() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.showToast('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•Toastæ¶ˆæ¯');
                document.getElementById('systemResult').textContent = 'å·²è°ƒç”¨Toastæ˜¾ç¤º';
            } catch (e) {
                document.getElementById('systemResult').textContent = 'Toastæ˜¾ç¤ºå¤±è´¥: ' + e.message;
            }
        }

        function onBackPressed() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.onBackPressed();
                document.getElementById('systemResult').textContent = 'å·²è§¦å‘è¿”å›äº‹ä»¶';
            } catch (e) {
                document.getElementById('systemResult').textContent = 'è§¦å‘è¿”å›äº‹ä»¶å¤±è´¥: ' + e.message;
            }
        }

        function closeWebView() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.onCloseWebViewFragment();
                document.getElementById('systemResult').textContent = 'å·²è°ƒç”¨å…³é—­WebView';
            } catch (e) {
                document.getElementById('systemResult').textContent = 'å…³é—­WebViewå¤±è´¥: ' + e.message;
            }
        }

        function getCurrentUiMode() {
            if (!checkInterface()) return;
            
            try {
                const uiMode = H5Interface.getCurrentUiMode();
                document.getElementById('systemResult').textContent = 'å½“å‰UIæ¨¡å¼: ' + uiMode;
            } catch (e) {
                document.getElementById('systemResult').textContent = 'è·å–UIæ¨¡å¼å¤±è´¥: ' + e.message;
            }
        }

        function turnToFaq() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.turnToFaq();
                document.getElementById('systemResult').textContent = 'å·²è·³è½¬åˆ°FAQé¡µé¢';
            } catch (e) {
                document.getElementById('systemResult').textContent = 'è·³è½¬FAQå¤±è´¥: ' + e.message;
            }
        }

        // äº‹ä»¶è¿½è¸ª
        function traceEvent() {
            if (!checkInterface()) return;
            
            const eventId = document.getElementById('eventId').value;
            const eventInfo = document.getElementById('eventInfo').value;
            try {
                H5Interface.onTraceDelayEvent(eventId, eventInfo);
                document.getElementById('eventResult').textContent = 'å·²å‘é€äº‹ä»¶è¿½è¸ª: ' + eventId;
            } catch (e) {
                document.getElementById('eventResult').textContent = 'äº‹ä»¶è¿½è¸ªå¤±è´¥: ' + e.message;
            }
        }

        // å…¶ä»–åŠŸèƒ½
        function getSignParams() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('signUrl').value;
            try {
                const signParams = H5Interface.h5GetSignParams(url);
                document.getElementById('otherResult').textContent = 'ç­¾åå‚æ•°: ' + signParams;
            } catch (e) {
                document.getElementById('otherResult').textContent = 'è·å–ç­¾åå‚æ•°å¤±è´¥: ' + e.message;
            }
        }

        function requestHttp() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('httpUrl').value;
            try {
                H5Interface.requestHttp(url);
                document.getElementById('otherResult').textContent = 'å·²å‘èµ·HTTPè¯·æ±‚: ' + url;
            } catch (e) {
                document.getElementById('otherResult').textContent = 'HTTPè¯·æ±‚å¤±è´¥: ' + e.message;
            }
        }

        function handlePageSuccess() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.handlePageSuccess();
                document.getElementById('otherResult').textContent = 'å·²é€šçŸ¥é¡µé¢åŠ è½½æˆåŠŸ';
            } catch (e) {
                document.getElementById('otherResult').textContent = 'é€šçŸ¥é¡µé¢åŠ è½½æˆåŠŸå¤±è´¥: ' + e.message;
            }
        }

        function createPreConnect() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.createPreConnect(1);
                document.getElementById('otherResult').textContent = 'å·²åˆ›å»ºé¢„è¿æ¥';
            } catch (e) {
                document.getElementById('otherResult').textContent = 'åˆ›å»ºé¢„è¿æ¥å¤±è´¥: ' + e.message;
            }
        }

        // è¿”å›é”®å¤„ç†
        let backPressCallbackRegistered = false;

        function testBackPressCallback() {
            console.log('è¿”å›é”®è¢«æŒ‰ä¸‹');
            document.getElementById('backResult').textContent = 'è¿”å›é”®å›è°ƒè¢«è§¦å‘: ' + new Date().toLocaleTimeString();
        }

        function registerBackPress() {
            if (!checkInterface()) return;
            
            try {
                const params = JSON.stringify({
                    backPressCallback: 'testBackPressCallback'
                });
                H5Interface.registerBack(params, '');
                backPressCallbackRegistered = true;
                document.getElementById('backResult').textContent = 'å·²æ³¨å†Œè¿”å›é”®ç›‘å¬';
            } catch (e) {
                document.getElementById('backResult').textContent = 'æ³¨å†Œè¿”å›é”®ç›‘å¬å¤±è´¥: ' + e.message;
            }
        }

        function unregisterBackPress() {
            if (!checkInterface()) return;
            
            try {
                const params = JSON.stringify({
                    backPressCallback: 'testBackPressCallback'
                });
                H5Interface.unregisterBack(params, '');
                backPressCallbackRegistered = false;
                document.getElementById('backResult').textContent = 'å·²å–æ¶ˆè¿”å›é”®ç›‘å¬';
            } catch (e) {
                document.getElementById('backResult').textContent = 'å–æ¶ˆè¿”å›é”®ç›‘å¬å¤±è´¥: ' + e.message;
            }
        }

        function testBackPress() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.webBackPress('', '');
                document.getElementById('backResult').textContent = 'å·²æ‰‹åŠ¨è§¦å‘è¿”å›é”®äº‹ä»¶';
            } catch (e) {
                document.getElementById('backResult').textContent = 'è§¦å‘è¿”å›é”®äº‹ä»¶å¤±è´¥: ' + e.message;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è·å–åŸºæœ¬ä¿¡æ¯
        window.onload = function() {
            if (checkInterface()) {
                console.log('H5Interface å·²å‡†å¤‡å°±ç»ª');
                
                // é€šçŸ¥åŸç”Ÿé¡µé¢åŠ è½½æˆåŠŸ
                try {
                    H5Interface.handlePageSuccess();
                } catch (e) {
                    console.error('é€šçŸ¥é¡µé¢åŠ è½½æˆåŠŸå¤±è´¥:', e);
                }
            }
        };

        // ç›‘å¬é¡µé¢å…³é—­å‰äº‹ä»¶
        window.onbeforeunload = function() {
            if (backPressCallbackRegistered) {
                try {
                    unregisterBackPress();
                } catch (e) {
                    console.error('é¡µé¢å…³é—­å‰å–æ¶ˆè¿”å›é”®ç›‘å¬å¤±è´¥:', e);
                }
            }
        };
    </script>
</body>
</html>
