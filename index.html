<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge 测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        
        .section h3 {
            color: #555;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        .result {
            background-color: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSBridge 测试页面</h1>
        
        <!-- 设备信息获取 -->
        <div class="section">
            <h3>📱 设备信息获取</h3>
            <button onclick="getDeviceInfo()">获取设备信息</button>
            <button onclick="getAppInfo()">获取应用信息</button>
            <button onclick="getNetworkInfo()">获取网络信息</button>
            <div id="deviceInfo" class="result"></div>
        </div>

        <!-- 用户相关 -->
        <div class="section">
            <h3>👤 用户相关</h3>
            <button onclick="checkLogin()">检查登录状态</button>
            <button onclick="gotoLogin()">跳转登录</button>
            <div id="userInfo" class="result"></div>
        </div>

        <!-- 页面导航 -->
        <div class="section">
            <h3>🔗 页面导航</h3>
            <div class="input-group">
                <label>H5 URL:</label>
                <input type="text" id="h5Url" placeholder="输入H5页面URL" value="https://example.com">
                <button onclick="jumpToH5()">跳转H5页面</button>
            </div>
            <div class="input-group">
                <label>APP包名:</label>
                <input type="text" id="appPackage" placeholder="输入APP包名" value="com.example.app">
                <button onclick="jumpToApp()">跳转APP</button>
                <button onclick="checkAppInstalled()">检查APP是否安装</button>
            </div>
            <div class="input-group">
                <label>视频URL:</label>
                <input type="text" id="videoUrl" placeholder="输入视频URL" value="http://example.com/video.mp4">
                <button onclick="playVideo()">播放视频</button>
            </div>
            <div id="navigationResult" class="result"></div>
        </div>

        <!-- 积分相关 -->
        <div class="section">
            <h3>🎯 积分相关</h3>
            <button onclick="getPointInfo()">获取积分信息</button>
            <button onclick="signInPoint()">签到积分</button>
            <div class="input-group">
                <label>积分变化:</label>
                <input type="number" id="balanceChange" placeholder="输入积分变化值" value="100">
                <button onclick="changeBalance()">触发积分变化</button>
            </div>
            <div id="pointResult" class="result"></div>
        </div>

        <!-- 支付相关 -->
        <div class="section">
            <h3>💰 支付相关</h3>
            <div class="input-group">
                <label>商品ID:</label>
                <input type="text" id="productId" placeholder="输入商品ID" value="product_001">
            </div>
            <div class="input-group">
                <label>订单信息:</label>
                <input type="text" id="orderInfo" placeholder="输入订单信息" value='{"orderId":"12345","amount":"99.00"}'>
            </div>
            <button onclick="onPay()">普通支付</button>
            <button onclick="onPaySingular()">单次支付</button>
            <button onclick="onPayAutoRenew()">自动续费支付</button>
            <div id="payResult" class="result"></div>
        </div>

        <!-- 系统功能 -->
        <div class="section">
            <h3>⚙️ 系统功能</h3>
            <button onclick="showToast()">显示Toast</button>
            <button onclick="onBackPressed()">触发返回</button>
            <button onclick="closeWebView()">关闭WebView</button>
            <button onclick="getCurrentUiMode()">获取UI模式</button>
            <button onclick="turnToFaq()">跳转FAQ</button>
            <div id="systemResult" class="result"></div>
        </div>

        <!-- 事件追踪 -->
        <div class="section">
            <h3>📊 事件追踪</h3>
            <div class="input-group">
                <label>事件ID:</label>
                <input type="text" id="eventId" placeholder="输入事件ID" value="page_view">
            </div>
            <div class="input-group">
                <label>事件信息:</label>
                <input type="text" id="eventInfo" placeholder="输入事件信息JSON" value='{"page":"test","action":"click"}'>
            </div>
            <button onclick="traceEvent()">追踪事件</button>
            <div id="eventResult" class="result"></div>
        </div>

        <!-- 其他功能 -->
        <div class="section">
            <h3>🔧 其他功能</h3>
            <div class="input-group">
                <label>URL签名:</label>
                <input type="text" id="signUrl" placeholder="输入需要签名的URL" value="https://api.example.com/data">
                <button onclick="getSignParams()">获取签名参数</button>
            </div>
            <div class="input-group">
                <label>HTTP请求:</label>
                <input type="text" id="httpUrl" placeholder="输入HTTP URL" value="https://api.example.com/test">
                <button onclick="requestHttp()">发起HTTP请求</button>
            </div>
            <button onclick="handlePageSuccess()">页面加载成功</button>
            <button onclick="createPreConnect()">创建预连接</button>
            <div id="otherResult" class="result"></div>
        </div>

        <!-- 返回键注册测试 -->
        <div class="section">
            <h3>⬅️ 返回键处理</h3>
            <button onclick="registerBackPress()">注册返回键监听</button>
            <button onclick="unregisterBackPress()">取消返回键监听</button>
            <button onclick="testBackPress()">测试返回键</button>
            <div id="backResult" class="result"></div>
        </div>
    </div>

    <script>
        // 检查H5Interface是否可用
        function checkInterface() {
            if (typeof H5Interface === 'undefined') {
                alert('H5Interface 不可用，请在支持的WebView环境中打开');
                return false;
            }
            return true;
        }

        // 设备信息获取
        function getDeviceInfo() {
            if (!checkInterface()) return;
            
            try {
                const deviceInfo = {
                    model: H5Interface.getModel(),
                    aaid: H5Interface.getAaid(),
                    oaid: H5Interface.getOaid(),
                    vaid: H5Interface.getVaid(),
                    u: H5Interface.getU(),
                    ua: H5Interface.getUa(),
                    vApp: H5Interface.getVApp(),
                    vOs: H5Interface.getVOs(),
                    av: H5Interface.getAv(),
                    cpuInfo: H5Interface.getCpuInfo(),
                    localIp: H5Interface.getLocalIpAddress(),
                    token: H5Interface.getToken()
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(deviceInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = '获取设备信息失败: ' + e.message;
            }
        }

        function getAppInfo() {
            if (!checkInterface()) return;
            
            try {
                const appInfo = {
                    appName: H5Interface.getAppName(),
                    channel: H5Interface.getChannel(),
                    featureList: H5Interface.getFeatureList(),
                    privacyVersion: H5Interface.getPrivacyVersion(),
                    appVersion: H5Interface.getAppVersion('com.vivo.video')
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(appInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = '获取应用信息失败: ' + e.message;
            }
        }

        function getNetworkInfo() {
            if (!checkInterface()) return;
            
            try {
                const networkInfo = {
                    netType: H5Interface.getNetType()
                };
                
                document.getElementById('deviceInfo').textContent = JSON.stringify(networkInfo, null, 2);
            } catch (e) {
                document.getElementById('deviceInfo').textContent = '获取网络信息失败: ' + e.message;
            }
        }

        // 用户相关
        function checkLogin() {
            if (!checkInterface()) return;
            
            try {
                const isLoggedIn = H5Interface.checkLoginStatus();
                document.getElementById('userInfo').textContent = '登录状态: ' + (isLoggedIn ? '已登录' : '未登录');
            } catch (e) {
                document.getElementById('userInfo').textContent = '检查登录状态失败: ' + e.message;
            }
        }

        function gotoLogin() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.gotoLogin('test_callback');
                document.getElementById('userInfo').textContent = '已调用登录接口';
            } catch (e) {
                document.getElementById('userInfo').textContent = '调用登录失败: ' + e.message;
            }
        }

        // 页面导航
        function jumpToH5() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('h5Url').value;
            try {
                H5Interface.jumpH5(url);
                document.getElementById('navigationResult').textContent = '已跳转到: ' + url;
            } catch (e) {
                document.getElementById('navigationResult').textContent = '跳转失败: ' + e.message;
            }
        }

        function jumpToApp() {
            if (!checkInterface()) return;
            
            const packageName = document.getElementById('appPackage').value;
            try {
                H5Interface.jumpToApp(packageName);
                document.getElementById('navigationResult').textContent = '已尝试打开APP: ' + packageName;
            } catch (e) {
                document.getElementById('navigationResult').textContent = '打开APP失败: ' + e.message;
            }
        }

        function checkAppInstalled() {
            if (!checkInterface()) return;
            
            const packageName = document.getElementById('appPackage').value;
            try {
                const isInstalled = H5Interface.isInstalledApp(packageName);
                document.getElementById('navigationResult').textContent = 
                    packageName + (isInstalled ? ' 已安装' : ' 未安装');
            } catch (e) {
                document.getElementById('navigationResult').textContent = '检查APP安装状态失败: ' + e.message;
            }
        }

        function playVideo() {
            if (!checkInterface()) return;
            
            const videoUrl = document.getElementById('videoUrl').value;
            try {
                H5Interface.playVideo(videoUrl);
                document.getElementById('navigationResult').textContent = '已调用播放视频: ' + videoUrl;
            } catch (e) {
                document.getElementById('navigationResult').textContent = '播放视频失败: ' + e.message;
            }
        }

        // 积分相关
        function getPointInfo() {
            if (!checkInterface()) return;
            
            try {
                const pointInfo = {
                    pointActivityKey: H5Interface.getPointActivityKey(),
                    pointPlayTime: H5Interface.getPointPlayTime()
                };
                
                document.getElementById('pointResult').textContent = JSON.stringify(pointInfo, null, 2);
            } catch (e) {
                document.getElementById('pointResult').textContent = '获取积分信息失败: ' + e.message;
            }
        }

        function signInPoint() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.signInPoint(true);
                document.getElementById('pointResult').textContent = '已调用签到积分接口';
            } catch (e) {
                document.getElementById('pointResult').textContent = '签到失败: ' + e.message;
            }
        }

        function changeBalance() {
            if (!checkInterface()) return;
            
            const balance = document.getElementById('balanceChange').value;
            try {
                H5Interface.onBalanceChange(parseInt(balance));
                document.getElementById('pointResult').textContent = '已触发积分变化: ' + balance;
            } catch (e) {
                document.getElementById('pointResult').textContent = '触发积分变化失败: ' + e.message;
            }
        }

        // 支付相关
        function onPay() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPay(productId, orderInfo);
                document.getElementById('payResult').textContent = '已调用普通支付接口';
            } catch (e) {
                document.getElementById('payResult').textContent = '支付调用失败: ' + e.message;
            }
        }

        function onPaySingular() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPaySingular(productId, orderInfo);
                document.getElementById('payResult').textContent = '已调用单次支付接口';
            } catch (e) {
                document.getElementById('payResult').textContent = '单次支付调用失败: ' + e.message;
            }
        }

        function onPayAutoRenew() {
            if (!checkInterface()) return;
            
            const productId = document.getElementById('productId').value;
            const orderInfo = document.getElementById('orderInfo').value;
            try {
                H5Interface.onPayAutoRenew(productId, orderInfo);
                document.getElementById('payResult').textContent = '已调用自动续费支付接口';
            } catch (e) {
                document.getElementById('payResult').textContent = '自动续费支付调用失败: ' + e.message;
            }
        }

        // 系统功能
        function showToast() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.showToast('这是一个测试Toast消息');
                document.getElementById('systemResult').textContent = '已调用Toast显示';
            } catch (e) {
                document.getElementById('systemResult').textContent = 'Toast显示失败: ' + e.message;
            }
        }

        function onBackPressed() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.onBackPressed();
                document.getElementById('systemResult').textContent = '已触发返回事件';
            } catch (e) {
                document.getElementById('systemResult').textContent = '触发返回事件失败: ' + e.message;
            }
        }

        function closeWebView() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.onCloseWebViewFragment();
                document.getElementById('systemResult').textContent = '已调用关闭WebView';
            } catch (e) {
                document.getElementById('systemResult').textContent = '关闭WebView失败: ' + e.message;
            }
        }

        function getCurrentUiMode() {
            if (!checkInterface()) return;
            
            try {
                const uiMode = H5Interface.getCurrentUiMode();
                document.getElementById('systemResult').textContent = '当前UI模式: ' + uiMode;
            } catch (e) {
                document.getElementById('systemResult').textContent = '获取UI模式失败: ' + e.message;
            }
        }

        function turnToFaq() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.turnToFaq();
                document.getElementById('systemResult').textContent = '已跳转到FAQ页面';
            } catch (e) {
                document.getElementById('systemResult').textContent = '跳转FAQ失败: ' + e.message;
            }
        }

        // 事件追踪
        function traceEvent() {
            if (!checkInterface()) return;
            
            const eventId = document.getElementById('eventId').value;
            const eventInfo = document.getElementById('eventInfo').value;
            try {
                H5Interface.onTraceDelayEvent(eventId, eventInfo);
                document.getElementById('eventResult').textContent = '已发送事件追踪: ' + eventId;
            } catch (e) {
                document.getElementById('eventResult').textContent = '事件追踪失败: ' + e.message;
            }
        }

        // 其他功能
        function getSignParams() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('signUrl').value;
            try {
                const signParams = H5Interface.h5GetSignParams(url);
                document.getElementById('otherResult').textContent = '签名参数: ' + signParams;
            } catch (e) {
                document.getElementById('otherResult').textContent = '获取签名参数失败: ' + e.message;
            }
        }

        function requestHttp() {
            if (!checkInterface()) return;
            
            const url = document.getElementById('httpUrl').value;
            try {
                H5Interface.requestHttp(url);
                document.getElementById('otherResult').textContent = '已发起HTTP请求: ' + url;
            } catch (e) {
                document.getElementById('otherResult').textContent = 'HTTP请求失败: ' + e.message;
            }
        }

        function handlePageSuccess() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.handlePageSuccess();
                document.getElementById('otherResult').textContent = '已通知页面加载成功';
            } catch (e) {
                document.getElementById('otherResult').textContent = '通知页面加载成功失败: ' + e.message;
            }
        }

        function createPreConnect() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.createPreConnect(1);
                document.getElementById('otherResult').textContent = '已创建预连接';
            } catch (e) {
                document.getElementById('otherResult').textContent = '创建预连接失败: ' + e.message;
            }
        }

        // 返回键处理
        let backPressCallbackRegistered = false;

        function testBackPressCallback() {
            console.log('返回键被按下');
            document.getElementById('backResult').textContent = '返回键回调被触发: ' + new Date().toLocaleTimeString();
        }

        function registerBackPress() {
            if (!checkInterface()) return;
            
            try {
                const params = JSON.stringify({
                    backPressCallback: 'testBackPressCallback'
                });
                H5Interface.registerBack(params, '');
                backPressCallbackRegistered = true;
                document.getElementById('backResult').textContent = '已注册返回键监听';
            } catch (e) {
                document.getElementById('backResult').textContent = '注册返回键监听失败: ' + e.message;
            }
        }

        function unregisterBackPress() {
            if (!checkInterface()) return;
            
            try {
                const params = JSON.stringify({
                    backPressCallback: 'testBackPressCallback'
                });
                H5Interface.unregisterBack(params, '');
                backPressCallbackRegistered = false;
                document.getElementById('backResult').textContent = '已取消返回键监听';
            } catch (e) {
                document.getElementById('backResult').textContent = '取消返回键监听失败: ' + e.message;
            }
        }

        function testBackPress() {
            if (!checkInterface()) return;
            
            try {
                H5Interface.webBackPress('', '');
                document.getElementById('backResult').textContent = '已手动触发返回键事件';
            } catch (e) {
                document.getElementById('backResult').textContent = '触发返回键事件失败: ' + e.message;
            }
        }

        // 页面加载完成后自动获取基本信息
        window.onload = function() {
            if (checkInterface()) {
                console.log('H5Interface 已准备就绪');
                
                // 通知原生页面加载成功
                try {
                    H5Interface.handlePageSuccess();
                } catch (e) {
                    console.error('通知页面加载成功失败:', e);
                }
            }
        };

        // 监听页面关闭前事件
        window.onbeforeunload = function() {
            if (backPressCallbackRegistered) {
                try {
                    unregisterBackPress();
                } catch (e) {
                    console.error('页面关闭前取消返回键监听失败:', e);
                }
            }
        };
    </script>
</body>
</html>
